{"version":3,"file":"calculateH1H2.js","sourceRoot":"","sources":["../src/calculateH1H2.ts"],"names":[],"mappings":"AAAA,2EAA2E;AAC3E,OAAO,iBAAiB,MAAM,qBAAqB,CAAC;AACpD,OAAO,EAAE,iBAAiB,EAAE,MAAM,UAAU,CAAC;AAE7C,OAAO,EAAE,QAAQ,EAAE,MAAM,SAAS,CAAC;AACnC,OAAO,EAAE,mBAAmB,EAAE,kBAAkB,EAAE,MAAM,cAAc,CAAC;AAEvE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA2CG;AACH,MAAM,CAAC,KAAK,UAAU,aAAa,CACjC,WAAoC,EACpC,OAAoB;IAEpB,gDAAgD;IAChD,QAAQ,CAAC,sBAAsB,EAAE;QAC/B,YAAY,EAAE,WAAW,CAAC,MAAM;QAChC,UAAU,EAAE,WAAW,YAAY,YAAY,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,UAAU;QAC7E,UAAU,EAAE,OAAO,CAAC,UAAU;QAC9B,EAAE,EAAE,OAAO,CAAC,EAAE;KACf,CAAC,CAAC;IAEH,mBAAmB,CAAC,WAAW,CAAC,CAAC;IACjC,kBAAkB,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IAEvC,sDAAsD;IACtD,8DAA8D;IAC9D,MAAM,WAAW,GACf,WAAW,YAAY,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;IAE9E,uBAAuB;IACvB,MAAM,aAAa,GAA4B,EAAE,CAAC;IAClD,IAAI,OAAO,CAAC,EAAE,KAAK,SAAS,IAAI,OAAO,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC;QAC/C,aAAa,CAAC,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;IAChC,CAAC;IAED,QAAQ,CAAC,6CAA6C,EAAE;QACtD,UAAU,EAAE,OAAO,CAAC,UAAU;QAC9B,YAAY,EAAE,WAAW,CAAC,MAAM;QAChC,aAAa;KACd,CAAC,CAAC;IAEH,IAAI,CAAC;QACH,6BAA6B;QAC7B,MAAM,YAAY,GAAG,MAAM,iBAAiB,CAAC,aAAa,CACxD,WAAW,EACX,OAAO,CAAC,UAAU,EAClB,aAAa,CACd,CAAC;QAEF,QAAQ,CAAC,qCAAqC,EAAE;YAC9C,IAAI,EAAE,YAAY,CAAC,IAAI;YACvB,aAAa,EAAE,YAAY,CAAC,aAAa;YACzC,aAAa,EAAE,YAAY,CAAC,aAAa;YACzC,EAAE,EAAE,YAAY,CAAC,EAAE;SACpB,CAAC,CAAC;QAEH,4CAA4C;QAC5C,MAAM,MAAM,GAAe;YACzB,IAAI,EAAE,YAAY,CAAC,IAAI;YACvB,aAAa,EAAE,YAAY,CAAC,aAAa;YACzC,aAAa,EAAE,YAAY,CAAC,aAAa;YACzC,EAAE,EAAE,YAAY,CAAC,EAAE;SACpB,CAAC;QAEF,QAAQ,CAAC,sCAAsC,EAAE,MAAM,CAAC,CAAC;QAEzD,OAAO,MAAM,CAAC;IAChB,CAAC;IAAC,OAAO,KAAc,EAAE,CAAC;QACxB,+DAA+D;QAC/D,MAAM,YAAY,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAE5E,QAAQ,CAAC,sBAAsB,EAAE;YAC/B,KAAK,EAAE,YAAY;YACnB,UAAU,EAAE,OAAO,CAAC,UAAU;YAC9B,YAAY,EAAE,WAAW,CAAC,MAAM;SACjC,CAAC,CAAC;QAEH,MAAM,IAAI,iBAAiB,CAAC,6BAA6B,YAAY,EAAE,EAAE;YACvE,aAAa,EAAE,KAAK;YACpB,UAAU,EAAE,OAAO,CAAC,UAAU;YAC9B,YAAY,EAAE,WAAW,CAAC,MAAM;SACjC,CAAC,CAAC;IACL,CAAC;AACH,CAAC","sourcesContent":["// calculateH1H2 - H1-H2 amplitude difference API for vocal weight analysis\nimport LoqaExpoDspModule from './LoqaExpoDspModule';\nimport { NativeModuleError } from './errors';\nimport type { H1H2Options, H1H2Result } from './types';\nimport { logDebug } from './utils';\nimport { validateAudioBuffer, validateSampleRate } from './validation';\n\n/**\n * Calculates H1-H2 amplitude difference for vocal weight analysis\n *\n * H1-H2 measures the difference in amplitude between the first harmonic (fundamental)\n * and second harmonic. It's a key acoustic correlate of vocal weight:\n * - Higher H1-H2 (>5 dB): Lighter, breathier vocal quality\n * - Lower H1-H2 (<0 dB): Fuller, heavier vocal quality\n * - Moderate H1-H2 (0-5 dB): Balanced vocal weight\n *\n * The function uses parabolic interpolation around the harmonic peaks for\n * accurate sub-bin amplitude estimation.\n *\n * @param audioBuffer - Audio samples (Float32Array or number[])\n * @param options - H1-H2 calculation options including sampleRate and optional pre-calculated f0\n * @returns Promise resolving to H1H2Result with h1h2, h1AmplitudeDb, h2AmplitudeDb, and f0\n * @throws ValidationError if buffer or sample rate are invalid\n * @throws NativeModuleError if native computation fails (e.g., unvoiced signal without f0)\n *\n * @example\n * ```typescript\n * const audioData = new Float32Array(4096);\n * // ... fill with audio samples ...\n *\n * // Option 1: Auto-detect F0\n * const result = await calculateH1H2(audioData, { sampleRate: 44100 });\n *\n * // Option 2: Provide pre-calculated F0 (more efficient if you already have it)\n * const pitch = await detectPitch(audioData, 44100);\n * const result2 = await calculateH1H2(audioData, {\n *   sampleRate: 44100,\n *   f0: pitch.frequency ?? undefined\n * });\n *\n * console.log(`H1-H2: ${result.h1h2} dB`);\n * console.log(`H1 amplitude: ${result.h1AmplitudeDb} dB`);\n * console.log(`H2 amplitude: ${result.h2AmplitudeDb} dB`);\n *\n * if (result.h1h2 > 5) {\n *   console.log('Lighter voice quality');\n * } else if (result.h1h2 < 0) {\n *   console.log('Fuller voice quality');\n * }\n * ```\n */\nexport async function calculateH1H2(\n  audioBuffer: Float32Array | number[],\n  options: H1H2Options\n): Promise<H1H2Result> {\n  // Step 1: Validate audio buffer and sample rate\n  logDebug('calculateH1H2 called', {\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n    sampleRate: options.sampleRate,\n    f0: options.f0,\n  });\n\n  validateAudioBuffer(audioBuffer);\n  validateSampleRate(options.sampleRate);\n\n  // Step 2: Convert to number[] for React Native bridge\n  // React Native bridge requires plain arrays, not typed arrays\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  // Build native options\n  const nativeOptions: Record<string, unknown> = {};\n  if (options.f0 !== undefined && options.f0 > 0) {\n    nativeOptions.f0 = options.f0;\n  }\n\n  logDebug('Calling native module for H1-H2 calculation', {\n    sampleRate: options.sampleRate,\n    bufferLength: bufferArray.length,\n    nativeOptions,\n  });\n\n  try {\n    // Step 3: Call native module\n    const nativeResult = await LoqaExpoDspModule.calculateH1H2(\n      bufferArray,\n      options.sampleRate,\n      nativeOptions\n    );\n\n    logDebug('Native module returned H1-H2 result', {\n      h1h2: nativeResult.h1h2,\n      h1AmplitudeDb: nativeResult.h1AmplitudeDb,\n      h2AmplitudeDb: nativeResult.h2AmplitudeDb,\n      f0: nativeResult.f0,\n    });\n\n    // Step 4: Convert result to H1H2Result type\n    const result: H1H2Result = {\n      h1h2: nativeResult.h1h2,\n      h1AmplitudeDb: nativeResult.h1AmplitudeDb,\n      h2AmplitudeDb: nativeResult.h2AmplitudeDb,\n      f0: nativeResult.f0,\n    };\n\n    logDebug('calculateH1H2 completed successfully', result);\n\n    return result;\n  } catch (error: unknown) {\n    // Step 5: Wrap native errors in NativeModuleError with context\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('calculateH1H2 failed', {\n      error: errorMessage,\n      sampleRate: options.sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`H1-H2 calculation failed: ${errorMessage}`, {\n      originalError: error,\n      sampleRate: options.sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n"]}