{"version":3,"file":"computeFFT.js","sourceRoot":"","sources":["../src/computeFFT.ts"],"names":[],"mappings":"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","sourcesContent":["// computeFFT - FFT computation API\nimport LoqaExpoDspModule from './LoqaExpoDspModule';\nimport { NativeModuleError } from './errors';\nimport type { FFTOptions, FFTResult } from './types';\nimport { logDebug } from './utils';\nimport { validateAudioBuffer, validateFFTSize } from './validation';\n\n/**\n * Computes Fast Fourier Transform (FFT) of audio buffer\n *\n * This function performs frequency analysis on audio data using the FFT algorithm.\n * It accepts audio buffers as Float32Array or number[], validates the input,\n * and returns magnitude and frequency information.\n *\n * @param audioBuffer - Audio samples (Float32Array or number[])\n * @param options - FFT configuration options\n * @returns Promise resolving to FFT result with magnitude, frequencies, and optional phase\n * @throws ValidationError if buffer or options are invalid\n * @throws NativeModuleError if native computation fails\n *\n * @example\n * ```typescript\n * const audioData = new Float32Array(1024);\n * // ... fill with audio samples ...\n *\n * const result = await computeFFT(audioData, {\n *   fftSize: 2048,\n *   windowType: 'hanning',\n *   includePhase: false\n * });\n *\n * console.log('Magnitude:', result.magnitude);\n * console.log('Frequencies:', result.frequencies);\n * ```\n */\nexport async function computeFFT(\n  audioBuffer: Float32Array | number[],\n  options?: FFTOptions\n): Promise<FFTResult> {\n  // Step 1: Validate audio buffer\n  logDebug('computeFFT called', {\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n    options,\n  });\n\n  validateAudioBuffer(audioBuffer);\n\n  // Step 2: Extract and validate options with defaults\n  const fftSize = options?.fftSize || audioBuffer.length;\n  const windowType = options?.windowType || 'hanning';\n  const includePhase = options?.includePhase || false;\n\n  // Validate FFT size\n  validateFFTSize(fftSize);\n\n  // Step 3: Convert to number[] for React Native bridge\n  // React Native bridge requires plain arrays, not typed arrays\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  logDebug('Calling native module', {\n    fftSize,\n    windowType,\n    includePhase,\n  });\n\n  try {\n    // Step 4: Call native module\n    // Default sample rate to 44100 Hz if not provided (used for frequency calculation)\n    const sampleRate = 44100; // Default sample rate for frequency bin calculation\n\n    const nativeResult = await LoqaExpoDspModule.computeFFT(bufferArray, {\n      fftSize,\n      windowType,\n      includePhase,\n      sampleRate,\n    });\n\n    logDebug('Native module returned', {\n      magnitudeLength: nativeResult.magnitude?.length,\n      hasPhase: !!nativeResult.phase,\n      frequenciesLength: nativeResult.frequencies?.length,\n    });\n\n    // Step 5: Convert result to FFTResult with Float32Array\n    // The native module returns plain arrays, but our API contract uses Float32Array\n    const result: FFTResult = {\n      magnitude: new Float32Array(nativeResult.magnitude),\n      phase: nativeResult.phase ? new Float32Array(nativeResult.phase) : undefined,\n      frequencies: new Float32Array(nativeResult.frequencies),\n    };\n\n    logDebug('computeFFT completed successfully', {\n      magnitudeLength: result.magnitude.length,\n      hasPhase: !!result.phase,\n    });\n\n    return result;\n  } catch (error: unknown) {\n    // Step 6: Wrap native errors in NativeModuleError with context\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('computeFFT failed', {\n      error: errorMessage,\n      fftSize,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`FFT computation failed: ${errorMessage}`, {\n      originalError: error,\n      fftSize,\n      windowType,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n"]}