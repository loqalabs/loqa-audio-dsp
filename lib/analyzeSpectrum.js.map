{"version":3,"file":"analyzeSpectrum.js","sourceRoot":"","sources":["../src/analyzeSpectrum.ts"],"names":[],"mappings":"AAAA,0CAA0C;AAC1C,OAAO,iBAAiB,MAAM,qBAAqB,CAAC;AACpD,OAAO,EAAE,iBAAiB,EAAE,MAAM,UAAU,CAAC;AAE7C,OAAO,EAAE,QAAQ,EAAE,MAAM,SAAS,CAAC;AACnC,OAAO,EAAE,mBAAmB,EAAE,kBAAkB,EAAE,MAAM,cAAc,CAAC;AAEvE;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4BG;AACH,MAAM,CAAC,KAAK,UAAU,eAAe,CACnC,WAAoC,EACpC,UAAkB,EAClB,OAA0C;IAE1C,gDAAgD;IAChD,QAAQ,CAAC,wBAAwB,EAAE;QACjC,YAAY,EAAE,WAAW,CAAC,MAAM;QAChC,UAAU,EAAE,WAAW,YAAY,YAAY,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,UAAU;QAC7E,UAAU;QACV,OAAO;KACR,CAAC,CAAC;IAEH,mBAAmB,CAAC,WAAW,CAAC,CAAC;IACjC,kBAAkB,CAAC,UAAU,CAAC,CAAC;IAE/B,sDAAsD;IACtD,8DAA8D;IAC9D,MAAM,WAAW,GACf,WAAW,YAAY,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;IAE9E,QAAQ,CAAC,6CAA6C,EAAE;QACtD,UAAU;QACV,YAAY,EAAE,WAAW,CAAC,MAAM;KACjC,CAAC,CAAC;IAEH,IAAI,CAAC;QACH,6BAA6B;QAC7B,MAAM,YAAY,GAAG,MAAM,iBAAiB,CAAC,eAAe,CAC1D,WAAW,EACX,UAAU,EACV,OAAO,IAAI,EAAE,CACd,CAAC;QAEF,QAAQ,CAAC,wCAAwC,EAAE;YACjD,QAAQ,EAAE,YAAY,CAAC,QAAQ;YAC/B,OAAO,EAAE,YAAY,CAAC,OAAO;YAC7B,IAAI,EAAE,YAAY,CAAC,IAAI;SACxB,CAAC,CAAC;QAEH,gDAAgD;QAChD,0EAA0E;QAC1E,MAAM,MAAM,GAAmB;YAC7B,QAAQ,EAAE,YAAY,CAAC,QAAQ;YAC/B,OAAO,EAAE,YAAY,CAAC,OAAO;YAC7B,IAAI,EAAE,YAAY,CAAC,IAAI;SACxB,CAAC;QAEF,QAAQ,CAAC,wCAAwC,EAAE;YACjD,QAAQ,EAAE,MAAM,CAAC,QAAQ;YACzB,OAAO,EAAE,MAAM,CAAC,OAAO;YACvB,IAAI,EAAE,MAAM,CAAC,IAAI;SAClB,CAAC,CAAC;QAEH,OAAO,MAAM,CAAC;IAChB,CAAC;IAAC,OAAO,KAAc,EAAE,CAAC;QACxB,+DAA+D;QAC/D,MAAM,YAAY,GAAG,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAE5E,QAAQ,CAAC,wBAAwB,EAAE;YACjC,KAAK,EAAE,YAAY;YACnB,UAAU;YACV,YAAY,EAAE,WAAW,CAAC,MAAM;SACjC,CAAC,CAAC;QAEH,MAAM,IAAI,iBAAiB,CAAC,6BAA6B,YAAY,EAAE,EAAE;YACvE,aAAa,EAAE,KAAK;YACpB,UAAU;YACV,YAAY,EAAE,WAAW,CAAC,MAAM;SACjC,CAAC,CAAC;IACL,CAAC;AACH,CAAC","sourcesContent":["// analyzeSpectrum - Spectral analysis API\nimport LoqaExpoDspModule from './LoqaExpoDspModule';\nimport { NativeModuleError } from './errors';\nimport type { SpectrumAnalysisOptions, SpectrumResult } from './types';\nimport { logDebug } from './utils';\nimport { validateAudioBuffer, validateSampleRate } from './validation';\n\n/**\n * Analyzes spectral features (centroid, rolloff, tilt)\n *\n * This function computes spectral characteristics of audio data, including:\n * - Spectral centroid: \"center of mass\" of the spectrum (brightness measure)\n * - Spectral rolloff: frequency below which 95% of energy is concentrated\n * - Spectral tilt: overall slope of the spectrum (timbre indicator)\n *\n * All features are computed in a single call for efficiency.\n *\n * @param audioBuffer - Audio samples (Float32Array or number[])\n * @param sampleRate - Sample rate in Hz (8000-48000)\n * @param options - Spectrum analysis options\n * @returns Promise resolving to spectrum result with centroid, rolloff, and tilt\n * @throws ValidationError if buffer or sample rate are invalid\n * @throws NativeModuleError if native computation fails\n *\n * @example\n * ```typescript\n * const audioData = new Float32Array(2048);\n * // ... fill with audio samples ...\n *\n * const result = await analyzeSpectrum(audioData, 44100);\n *\n * console.log(`Spectral centroid: ${result.centroid} Hz`);\n * console.log(`Spectral rolloff: ${result.rolloff} Hz`);\n * console.log(`Spectral tilt: ${result.tilt}`);\n * ```\n */\nexport async function analyzeSpectrum(\n  audioBuffer: Float32Array | number[],\n  sampleRate: number,\n  options?: Partial<SpectrumAnalysisOptions>\n): Promise<SpectrumResult> {\n  // Step 1: Validate audio buffer and sample rate\n  logDebug('analyzeSpectrum called', {\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n    sampleRate,\n    options,\n  });\n\n  validateAudioBuffer(audioBuffer);\n  validateSampleRate(sampleRate);\n\n  // Step 2: Convert to number[] for React Native bridge\n  // React Native bridge requires plain arrays, not typed arrays\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  logDebug('Calling native module for spectrum analysis', {\n    sampleRate,\n    bufferLength: bufferArray.length,\n  });\n\n  try {\n    // Step 3: Call native module\n    const nativeResult = await LoqaExpoDspModule.analyzeSpectrum(\n      bufferArray,\n      sampleRate,\n      options || {}\n    );\n\n    logDebug('Native module returned spectrum result', {\n      centroid: nativeResult.centroid,\n      rolloff: nativeResult.rolloff,\n      tilt: nativeResult.tilt,\n    });\n\n    // Step 4: Convert result to SpectrumResult type\n    // Native module returns dictionary/map, convert to proper TypeScript type\n    const result: SpectrumResult = {\n      centroid: nativeResult.centroid,\n      rolloff: nativeResult.rolloff,\n      tilt: nativeResult.tilt,\n    };\n\n    logDebug('analyzeSpectrum completed successfully', {\n      centroid: result.centroid,\n      rolloff: result.rolloff,\n      tilt: result.tilt,\n    });\n\n    return result;\n  } catch (error: unknown) {\n    // Step 5: Wrap native errors in NativeModuleError with context\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('analyzeSpectrum failed', {\n      error: errorMessage,\n      sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`Spectrum analysis failed: ${errorMessage}`, {\n      originalError: error,\n      sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n"]}