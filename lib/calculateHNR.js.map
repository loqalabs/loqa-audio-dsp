{"version":3,"file":"calculateHNR.js","sourceRoot":"","sources":["../src/calculateHNR.ts"],"names":[],"mappings":"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","sourcesContent":["// calculateHNR - Harmonics-to-Noise Ratio API for breathiness analysis\nimport LoqaExpoDspModule from './LoqaExpoDspModule';\nimport { NativeModuleError } from './errors';\nimport type { HNROptions, HNRResult } from './types';\nimport { logDebug } from './utils';\nimport { validateAudioBuffer, validateSampleRate } from './validation';\n\n/**\n * Calculates Harmonics-to-Noise Ratio (HNR) for breathiness analysis\n *\n * HNR measures the ratio of harmonic (periodic) to noise (aperiodic) energy\n * in voice, providing a quantitative measure of breathiness. It uses\n * Boersma's autocorrelation-based method.\n *\n * Typical HNR ranges:\n * - 18-25 dB: Clear, less breathy voice\n * - 12-18 dB: Softer, more breathy voice\n * - <10 dB: Very breathy or pathological voice\n *\n * @param audioBuffer - Audio samples (Float32Array or number[])\n * @param options - HNR calculation options including sampleRate and optional frequency range\n * @returns Promise resolving to HNRResult with hnr (dB), f0 (Hz), and isVoiced flag\n * @throws ValidationError if buffer or sample rate are invalid\n * @throws NativeModuleError if native computation fails\n *\n * @example\n * ```typescript\n * const audioData = new Float32Array(4096);\n * // ... fill with audio samples ...\n *\n * const result = await calculateHNR(audioData, { sampleRate: 44100 });\n *\n * if (result.isVoiced) {\n *   console.log(`HNR: ${result.hnr} dB`);\n *   console.log(`Detected F0: ${result.f0} Hz`);\n *\n *   if (result.hnr > 20) {\n *     console.log('Clear voice detected');\n *   } else if (result.hnr < 15) {\n *     console.log('Breathy voice detected');\n *   }\n * } else {\n *   console.log('Signal is unvoiced');\n * }\n * ```\n */\nexport async function calculateHNR(\n  audioBuffer: Float32Array | number[],\n  options: HNROptions\n): Promise<HNRResult> {\n  // Step 1: Validate audio buffer and sample rate\n  logDebug('calculateHNR called', {\n    bufferLength: audioBuffer.length,\n    bufferType: audioBuffer instanceof Float32Array ? 'Float32Array' : 'number[]',\n    sampleRate: options.sampleRate,\n    minFreq: options.minFreq,\n    maxFreq: options.maxFreq,\n  });\n\n  validateAudioBuffer(audioBuffer);\n  validateSampleRate(options.sampleRate);\n\n  // Step 2: Convert to number[] for React Native bridge\n  // React Native bridge requires plain arrays, not typed arrays\n  const bufferArray: number[] =\n    audioBuffer instanceof Float32Array ? Array.from(audioBuffer) : audioBuffer;\n\n  // Build native options\n  const nativeOptions: Record<string, unknown> = {};\n  if (options.minFreq !== undefined) {\n    nativeOptions.minFreq = options.minFreq;\n  }\n  if (options.maxFreq !== undefined) {\n    nativeOptions.maxFreq = options.maxFreq;\n  }\n\n  logDebug('Calling native module for HNR calculation', {\n    sampleRate: options.sampleRate,\n    bufferLength: bufferArray.length,\n    nativeOptions,\n  });\n\n  try {\n    // Step 3: Call native module\n    const nativeResult = await LoqaExpoDspModule.calculateHNR(\n      bufferArray,\n      options.sampleRate,\n      nativeOptions\n    );\n\n    logDebug('Native module returned HNR result', {\n      hnr: nativeResult.hnr,\n      f0: nativeResult.f0,\n      isVoiced: nativeResult.isVoiced,\n    });\n\n    // Step 4: Convert result to HNRResult type\n    const result: HNRResult = {\n      hnr: nativeResult.hnr,\n      f0: nativeResult.f0,\n      isVoiced: nativeResult.isVoiced,\n    };\n\n    logDebug('calculateHNR completed successfully', result);\n\n    return result;\n  } catch (error: unknown) {\n    // Step 5: Wrap native errors in NativeModuleError with context\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    logDebug('calculateHNR failed', {\n      error: errorMessage,\n      sampleRate: options.sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n\n    throw new NativeModuleError(`HNR calculation failed: ${errorMessage}`, {\n      originalError: error,\n      sampleRate: options.sampleRate,\n      bufferLength: audioBuffer.length,\n    });\n  }\n}\n"]}